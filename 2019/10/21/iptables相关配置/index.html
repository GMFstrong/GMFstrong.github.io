<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iptables相关配置 | ConqUeroR</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="IPTABLES是工作在用户空间，用来管理内核空间的netfilter的工具。  1) iptables的默认在各个链上的策略为ACCEPT。123456789101.修改INPUT链默认策略：iptables -P INPUT DROP2.创建自定义的链：iptables -N WEB  #不能直接应用，需要在系统链中引用。3.删除自定义的链：iptables -X WEB  #自定义的链不能有">
<meta property="og:type" content="article">
<meta property="og:title" content="iptables相关配置">
<meta property="og:url" content="http://gmfdevops.com.com/2019/10/21/iptables相关配置/index.html">
<meta property="og:site_name" content="ConqUeroR">
<meta property="og:description" content="IPTABLES是工作在用户空间，用来管理内核空间的netfilter的工具。  1) iptables的默认在各个链上的策略为ACCEPT。123456789101.修改INPUT链默认策略：iptables -P INPUT DROP2.创建自定义的链：iptables -N WEB  #不能直接应用，需要在系统链中引用。3.删除自定义的链：iptables -X WEB  #自定义的链不能有">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-21T05:24:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iptables相关配置">
<meta name="twitter:description" content="IPTABLES是工作在用户空间，用来管理内核空间的netfilter的工具。  1) iptables的默认在各个链上的策略为ACCEPT。123456789101.修改INPUT链默认策略：iptables -P INPUT DROP2.创建自定义的链：iptables -N WEB  #不能直接应用，需要在系统链中引用。3.删除自定义的链：iptables -X WEB  #自定义的链不能有">
  
    <link rel="alternative" href="/atom.xml" title="ConqUeroR" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("your_app_id", "your_app_key");</script>
<script src="/js/Counter.js"></script>
  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1530275036756&amp;di=fbef4a64ede1f8237b28de7618e9a502&amp;imgtype=0&amp;src=http%3A%2F%2Ftx.haiqq.com%2Fuploads%2Fallimg%2F170507%2F0Q25BU9-8.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">ConqUeroR</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/websec">Web安全</a></li>
				        
							<li><a href="/categories/linux">Linux基础</a></li>
				        
							<li><a href="/categories/linux-ser1">Linux服务</a></li>
				        
							<li><a href="/categories/linux-ser2">Linux集群</a></li>
				        
							<li><a href="/categories/shell">Shell编程</a></li>
				        
							<li><a href="/categories/python">Python脚本</a></li>
				        
							<li><a href="/categories/network">网络配置</a></li>
				        
							<li><a href="/categories/other">其它</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">ConqUeroR</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1530275036756&amp;di=fbef4a64ede1f8237b28de7618e9a502&amp;imgtype=0&amp;src=http%3A%2F%2Ftx.haiqq.com%2Fuploads%2Fallimg%2F170507%2F0Q25BU9-8.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">ConqUeroR</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/websec">Web安全</a></li>
		        
					<li><a href="/categories/linux">Linux基础</a></li>
		        
					<li><a href="/categories/linux-ser1">Linux服务</a></li>
		        
					<li><a href="/categories/linux-ser2">Linux集群</a></li>
		        
					<li><a href="/categories/shell">Shell编程</a></li>
		        
					<li><a href="/categories/python">Python脚本</a></li>
		        
					<li><a href="/categories/network">网络配置</a></li>
		        
					<li><a href="/categories/other">其它</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-iptables相关配置" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/10/21/iptables相关配置/" class="article-date">
  	<time datetime="2019-10-21T05:21:48.000Z" itemprop="datePublished">2019-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iptables相关配置
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/linux-ser1/">linux-ser1</a>
	</div>


        
          
<div class="counter-tag counter">
    <span id="/2019/10/21/iptables相关配置/" class="leancloud_visitors post-title-link"
          style="font-size: 12px" data-flag-title="iptables相关配置">
         &nbsp;
        view
    </span>
</div>

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>IPTABLES是工作在用户空间，用来管理内核空间的netfilter的工具。</p>
<blockquote>
<p>1) iptables的默认在各个链上的策略为ACCEPT。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.修改INPUT链默认策略：</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">2.创建自定义的链：</span><br><span class="line">iptables -N WEB  #不能直接应用，需要在系统链中引用。</span><br><span class="line">3.删除自定义的链：</span><br><span class="line">iptables -X WEB  #自定义的链不能有规则，必须先清空规制。</span><br><span class="line">4.清空指定的链：</span><br><span class="line">iptables -F WEB</span><br><span class="line">5.修改自定义的链名：</span><br><span class="line">iptables -E WEB test</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>2) 查看iptables中定义的规制：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-L：list, 列出指定鏈上的所有规则，本选项须置后</span><br><span class="line">-n：numberic，以数字格式显示地址和端口号</span><br><span class="line">-v：verbose，详细信息</span><br><span class="line">-vv 更详细</span><br><span class="line">-x：exactly，显示计数器结果的精确值,而非单位转换后的易读值</span><br><span class="line">--line-numbers：显示规则的序号</span><br><span class="line">iptables -vnL --line-numbers    #-vnL必须将L放在最后</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>3) 管理链上的规制：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-A：append，追加到指定链上最后。</span><br><span class="line">-I：insert, 插入指定链规制，要指明插入至的规则编号，默认插到第一条。</span><br><span class="line">iptables -I INPUT 2 -s 127.0.0.1 -j REJECT #将该规制插入到第二条的位置。</span><br><span class="line">-D：delete，删除指定链规制，(1) 指明规则序号 (2) 指明规则本身。</span><br><span class="line">iptables -D INPUT 2</span><br><span class="line">iptables -D INPUT -s 192.168.38.67 -j REJECT #相当于把加入该规制的A或I变换成D</span><br><span class="line">-R：replace，修改指定链上指定序号的规制。</span><br><span class="line">iptables -R INPUT 2 -s 192.168.38.67 -j DROP</span><br><span class="line">-F：flush，清空指定的规则链。</span><br><span class="line">iptables的每条规则都有两个计数器：</span><br><span class="line">(1) 匹配到的报文的个数</span><br><span class="line">(2) 匹配到的所有报文的大小之和</span><br><span class="line">-Z：zero，置零以上计数器。</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>4) 基本匹配条件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-s 源IP地址或范围</span><br><span class="line">-d 目标IP地址或范围</span><br><span class="line">-p 指定协议,使用数字</span><br><span class="line">-i 报文流入的接口；只能应用于数据报文流入环节，只应用于INPUT、FORWARD、PREROUTING链</span><br><span class="line">-o 报文流入的接口；只能应用于数据报文流入环节，只应用于INPUT、FORWARD、PREROUTING链</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>5)扩展的匹配规制：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">需要加载扩展模块（/usr/lib64/xtables/*.so）</span><br><span class="line">--sport 匹配报文源端口,可为端口范围</span><br><span class="line">--dport 匹配报文目标端口,可为范围</span><br><span class="line">--tcp-flags mask comp </span><br><span class="line">    mask 需检查的标志位列表，用,分隔。例如 SYN,ACK,FIN,RST</span><br><span class="line">    comp 在mask列表中必须为1的标志位列表，无指定则必须为0，用,分隔</span><br><span class="line">    例如：--tcp-flags SYN,ACK,FIN,RST SYN 表示要检查的标志位为SYN,ACK,FIN,RST四个，其中SYN必须为1，余下的必须为0</span><br><span class="line">--syn：用于匹配第一次握手相当于：--tcp-flags SYN,ACK,FIN,RST SYN</span><br><span class="line">    例如：iptables -A INPUT -p tcp --syn -j REJECT </span><br><span class="line">          表示就得TCP连接保持，若有新的TCP连接进来，则拒绝。</span><br><span class="line">-p支持的协议为： tcp, udp, icmp, icmpv6, udplite,esp, ah, sctp, mh</span><br><span class="line">    例如：iptables -A INPUT -p icmp --icmp-type echo-request -j REJECT</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>6) 显式指定需要加载的模块：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1.multiport扩展：以离散方式定义多端口匹配,最多指定15个端口。</span><br><span class="line">    --sports 指定多个源端口</span><br><span class="line">    --dports 指定多个目标端口</span><br><span class="line">    --ports  多个源或目标端口</span><br><span class="line">    例如：iptables -I INPUT 2 -s 192.168.38.0/24 -d 192.168.38.0/24 -p tcp -m multiport --dports 22,21,80 -j ACCEPT</span><br><span class="line">2.iprange扩展：指明连续的ip地址范围 （但一般不是整个网络）</span><br><span class="line">    --src-range from-to 源IP地址范围</span><br><span class="line">    --dst-range from-to 目标IP地址范围</span><br><span class="line">    例如：iptables -A INPUT -d 192.168.38.57 -p tcp --dport 80 -m iprange --src-range 192.168.38.57-192.168.38.100 -j DROP</span><br><span class="line">3.mac扩展：指明源MAC地址</span><br><span class="line">    --mac-source XX:XX:XX:XX:XX:XX</span><br><span class="line">    例如：iptables -A INPUT -d 192.168.38.57 -p tcp --dport 80 -m mac --mac-source 00:0c:29:6a:78:fa -j REJECT</span><br><span class="line">4.string扩展：对报文中的应用层数据做字符串模式匹配检测。</span><br><span class="line">    --algo 字符串匹配检测算法</span><br><span class="line">        bm：Boyer-Moore</span><br><span class="line">        kmp：Knuth-Pratt-Morris</span><br><span class="line">    --from offset 开始偏移</span><br><span class="line">    --to offset 结束偏移   </span><br><span class="line">    --string pattern 要检测的字符串模式</span><br><span class="line">    --hex-string pattern要检测字符串模式，16进制格式</span><br><span class="line">    例如：iptables -A OUTPUT -d 192.168.38.67 -p tcp --sport 80 -m string --algo bm --string &quot;sbsb&quot; -j  REJECT</span><br><span class="line">5.time扩展：根据将报文到达的时间与指定的时间范围进行匹配。</span><br><span class="line">    --datestart YYYY[-MM[-DD[Thh[:mm[:ss]]]]] 日期</span><br><span class="line">    --datestop YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</span><br><span class="line">    --timestart hh:mm[:ss] 时间</span><br><span class="line">    --timestop hh:mm[:ss]</span><br><span class="line">    --monthdays day[,day...] 每个月的几号</span><br><span class="line">    --weekdays day[,day...] 星期几，1 – 7 分别表示星期一到星期日</span><br><span class="line">    --kerneltz：内核时区，不建议使用，CentOS7系统默认为UTC</span><br><span class="line">    centos6 不支持kerneltz ，--localtz指定本地时区(默认)</span><br><span class="line">    例如：iptables -A INPUT -d 192.168.38.57 -p tcp --dport 80 -m time --timestart 4:00 --timestop 12:00 -j REJECT</span><br><span class="line">6.connlimit扩展：根据每客户端IP做并发连接数数量匹配，可防止简单Dos(Denial of Service，拒绝服务)攻击。</span><br><span class="line">    --connlimit-upto #：连接的数量小于等于#时匹配</span><br><span class="line">    --connlimit-above #：连接的数量大于#时匹配</span><br><span class="line">    例如：iptables -A INPUT -d 192.168.38.57 -p tcp --dport 22 -m connlimit --connlimit-above 2 -j REJECT</span><br><span class="line">7.imit扩展：基于收发报文的速率做匹配。</span><br><span class="line">    --limit #[/second|/minute|/hour|/day]</span><br><span class="line">    --limit-burst number</span><br><span class="line">    例如：iptables -A INPUT -d 192.168.38.57 -p icmp --icmp-type echo-request -m limit --limit 10/minute --limit-burst 5 -j ACCEPT</span><br><span class="line">    表示前5个包不限制，以后平均每分钟通过10个包。</span><br><span class="line">8.state扩展：根据”连接追踪机制“去检查连接的状态，较耗资源 。</span><br><span class="line">    NEW：新发出请求；连接追踪信息库中不存在此连接的相关信息条目，因此，将其识别为第一次发出的请求。</span><br><span class="line">    ESTABLISHED：NEW状态之后，连接追踪信息库中为其建立的条目失效之前期间内所进行的通信状态。</span><br><span class="line">    RELATED：新发起的但与已有连接相关联的连接，如：ftp协议中的数据连接与命令连接之间的关系。</span><br><span class="line">    INVALID：无效的连接，如flag标记不正确。</span><br><span class="line">    UNTRACKED：未进行追踪的连接，如raw表中关闭追踪。</span><br><span class="line">    已经追踪到的并记录下来的连接信息库：/proc/net/nf_conntrack</span><br><span class="line">    调整连接追踪功能所能够容纳的最大连接数量：/proc/sys/net/nf_conntrack_max</span><br><span class="line">    不同的协议的连接追踪时长：/proc/sys/net/netfilter/</span><br><span class="line">    CentOS7 需要加载模块： modprobe nf_conntrack_ipv4</span><br><span class="line">    iptables的链接跟踪表最大容量为/proc/sys/net/nf_conntrack_max，各种状态的超时链接会从表中删除；当模</span><br><span class="line">    板满载时，后续连接可能会超时</span><br><span class="line">解决方法两个：</span><br><span class="line">    (1) 加大nf_conntrack_max 值</span><br><span class="line">    vi /etc/sysctl.conf</span><br><span class="line">    net.nf_conntrack_max = 393216</span><br><span class="line">    net.netfilter.nf_conntrack_max = 393216</span><br><span class="line">    (2) 降低 nf_conntrack timeout时间</span><br><span class="line">    vi /etc/sysctl.conf</span><br><span class="line">    net.netfilter.nf_conntrack_tcp_timeout_established = 300</span><br><span class="line">    net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120</span><br><span class="line">    net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60</span><br><span class="line">    net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120</span><br><span class="line">    iptables –I INPUT -d LocalIP -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">    iptables -A INPUT -d LocalIP -p tcp --dport 21 -m state --state NEW -j ACCEPT</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>7) iptables的规制默认保存期限为内核存活期限（重启机器就会清空）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">永久保存iptables规制：</span><br><span class="line">CentOS 7</span><br><span class="line">    iptables-save &gt; /PATH/TO/SOME_RULES_FILE</span><br><span class="line">    若要开机自动启用该规则，需要安装iptables-service，保存到/etc/sysconfig/iptables文件中</span><br><span class="line">    重新载入预存规则文件中规则：</span><br><span class="line">    iptables-restore &lt; /PATH/FROM/SOME_RULES_FILE</span><br><span class="line">    -n, --noflush：不清除原有规则</span><br><span class="line">    -t, --test：仅分析生成规则集，但不提交</span><br><span class="line">CentOS 6</span><br><span class="line">    service iptables save 将规则覆盖保存至/etc/sysconfig/iptables文件中</span><br><span class="line">    service iptables restart</span><br><span class="line">    会自动从/etc/sysconfig/iptables 重新载入规则</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><strong><em>添加临时路由：ip route add 172.168.8.0/24 via 192.168.38.67</em></strong></p>
<blockquote>
<p>8) 基于iptables的NAT:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.SNAT:</span><br><span class="line">    iptables -t nat -A POSTROUTING -s 172.168.8.47 ! -d  172.168.8.0/24 -j SNAT --to-source 192.168.38.67</span><br><span class="line">    在拨号上网中，网关地址可能会发生变化，可用MASQUERADE，进行动态监视：</span><br><span class="line">    iptables -t nat -A POSTROUTING -s 10.0.1.0/24 ! –d 10.0.1.0/24 -j MASQUERADE</span><br><span class="line">2.DNAT:</span><br><span class="line">    iptables -t nat -A PREROUTING -s 0/0 -d 172.168.8.67 -p tcp --dport 10086 -j DNAT --to-destination 192.168.38.57:22</span><br><span class="line">3.REDIRECT：（在web服务器上设置）</span><br><span class="line">    iptables -t nat -A PREROUTING -s 0/0 -d 192.168.38.57 -p tcp --dport 80   -j REDIRECT --to-ports 8080</span><br></pre></td></tr></table></figure></p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/10/21/LVS集群调度/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          LVS集群调度
        
      </div>
    </a>
  
  
    <a href="/2019/10/17/关于Linux日志/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">关于Linux日志</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="iptables相关配置" data-title="iptables相关配置" data-url="http://gmfdevops.com.com/2019/10/21/iptables相关配置/"  data-images="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1530275036756&amp;di=fbef4a64ede1f8237b28de7618e9a502&amp;imgtype=0&amp;src=http%3A%2F%2Ftx.haiqq.com%2Fuploads%2Fallimg%2F170507%2F0Q25BU9-8.jpg" data-content="iptables相关配置">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2019 ConqUeroR
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>